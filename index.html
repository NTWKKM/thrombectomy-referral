<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÉ‡∏ö‡∏™‡πà‡∏á‡∏ï‡∏±‡∏ß Stroke FAST TRACK - Mechanical Thrombectomy</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a5f7a;
            --secondary: #f0ad4e;
            --danger: #d9534f;
            --success: #5cb85c;
            --light: #f5f5f5;
            --white: #ffffff;
            --dark: #333;
            --border: #ddd;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', Arial, sans-serif;
            background: var(--light);
            color: var(--dark);
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        header {
            background: var(--primary);
            color: var(--white);
            padding: 20px;
            text-align: center;
            border-radius: 8px 8px 0 0;
        }

        header h1 {
            font-size: 22px;
            margin-bottom: 5px;
        }

        header p {
            font-size: 12px;
            opacity: 0.9;
        }

        .content {
            padding: 20px;
        }

        .section {
            margin-bottom: 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
        }

        .section-header {
            background: #e8f4f8;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: var(--primary);
            user-select: none;
        }

        .section-header:hover {
            background: #d0e8f0;
        }

        .section-header .toggle {
            font-size: 18px;
            transition: transform 0.3s;
        }

        .section-body {
            padding: 15px;
            display: none;
        }

        .section-body.active {
            display: block;
        }

        .form-group {
            margin-bottom: 10px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dark);
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        input[type="time"],
        input[type="tel"],
        select,
        textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Sarabun', Arial, sans-serif;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 5px rgba(26, 95, 122, 0.3);
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .row.three {
            grid-template-columns: 1fr 1fr 1fr;
        }
        
        .row.four {
            grid-template-columns: 1fr 1fr 1fr 1fr;
        }

        .row.five {
            grid-template-columns: repeat(5, 1fr);
        }

        .checkbox-group,
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 8px;
        }

        .checkbox-item,
        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"],
        input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label,
        .radio-item label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }

        .motor-group, .sensory-group {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 12px;
        }

        .motor-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 12px;
        }
        
        .motor-row:last-child { margin-bottom: 0; }

        .motor-item {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            align-items: end;
        }

        .sensory-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .sensory-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sensory-item label {
            margin-bottom: 0;
            white-space: nowrap;
            min-width: 30px;
        }

        .calculate-box {
            background: #fffbea;
            padding: 12px;
            border-left: 4px solid var(--secondary);
            border-radius: 4px;
            margin-top: 10px;
        }

        .calculate-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .calculate-item:last-child { border-bottom: none; }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 30px;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-primary:hover { background: #154a5f; transform: translateY(-2px); }
        .btn-secondary { background: var(--secondary); color: var(--white); }
        .btn-secondary:hover { background: #ec971f; }
        .btn-danger { background: var(--danger); color: var(--white); }
        .btn-danger:hover { background: #c9302c; }
        .btn-info { background: #17a2b8; color: var(--white); } 
        .btn-info:hover { background: #138496; }

        /* Print Preview Styles */
        .print-preview {
            display: none;
            background: var(--white);
            padding: 0;
            margin: 0;
        }

        .print-preview.show { display: block; }

        .print-document {
            background: var(--white);
            padding: 20px 30px;
            margin: 0 auto;
            max-width: 210mm;
            box-shadow: none;
            font-family: 'Sarabun', sans-serif;
            font-size: 12px;
            line-height: 1.3;
            position: relative;
        }

        .print-header {
            text-align: center;
            margin-bottom: 8px;
            border-bottom: 2px solid var(--dark);
            border-top: 2px solid var(--dark);
            padding: 8px 0;
            position: relative;
        }

        .print-header h1 {
            font-size: 16px;
            color: var(--dark);
            margin-bottom: 2px;
            font-weight: bold;
        }

        .print-section {
            margin-bottom: 6px;
            page-break-inside: avoid;
        }

        .print-section-title {
            background: #eee;
            padding: 3px 5px;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 4px;
            border-bottom: 1px solid var(--dark);
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .print-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 3px;
        }

        .print-col-100 { width: 100%; }
        .print-col-50 { width: calc(50% - 5px); }
        .print-col-33 { width: calc(33.33% - 7px); }
        .print-col-25 { width: calc(25% - 8px); }
        
        .print-layout-loc {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1.2fr 1fr;
            gap: 10px;
            width: 100%;
        }

        .print-field {
            border-bottom: 1px dotted #999;
            padding-bottom: 1px;
            display: flex;
            align-items: baseline;
        }

        .print-field-label {
            font-size: 11px;
            color: #333;
            font-weight: normal;
            margin-right: 5px;
            white-space: nowrap;
        }

        .print-field-value {
            font-size: 12px;
            color: #000;
            font-weight: bold;
            flex-grow: 1;
        }

        /* Checkbox style for print */
        .checkbox-square {
            display: inline-block;
            width: 10px;
            height: 10px;
            border: 1px solid #000;
            margin-right: 3px;
            margin-left: 8px;
            vertical-align: middle;
            background: #fff;
        }
        .checkbox-square:first-child { margin-left: 0; }
        .checkbox-label { margin-right: 8px; }

        .print-box {
            border: 1px solid #ccc;
            padding: 5px;
            margin: 3px 0;
            background: #fff;
        }

        .print-signature {
            margin-top: 20px;
            text-align: right;
            padding-right: 20px;
        }

        .signature-line {
            border-top: 1px solid var(--dark);
            width: 200px;
            margin-left: auto;
            padding-top: 5px;
            font-size: 11px;
            text-align: center;
        }

        @media print {
            body, .container, header, .content, .button-group {
                display: none;
            }
            .print-preview {
                display: block;
                position: absolute;
                top: 0; left: 0; width: 100%;
            }
            .print-document {
                box-shadow: none;
                padding: 0;
                max-width: 100%;
                width: 100%;
            }
            .print-preview button { display: none !important; }
            @page {
                size: A4;
                margin: 1cm;
            }
        }
        
        @media (max-width: 768px) {
            .row, .row.three, .row.five, .motor-row, .sensory-group {
                grid-template-columns: 1fr;
            }
            .print-layout-loc {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè• Stroke FAST TRACK - Mechanical Thrombectomy Referral</h1>
            <p>Maharat nakhonratchasima Hospital</p>
        </header>

        <div class="content">
            <form id="referralForm">
                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span>üìã Section 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</span>
                        <span class="toggle">‚ñº</span>
                    </div>
                    <div class="section-body active">
                        <div class="row">
                            <div class="form-group">
                                <label>HN / Patient ID</label>
                                <input type="text" id="hn" placeholder="‡πÄ‡∏ä‡πà‡∏ô 123456" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" required>
                            </div>
                        </div>

                        <div class="row three">
                            <div class="form-group">
                                <label>‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
                                <input type="number" id="age" placeholder="‡∏õ‡∏µ" min="0" max="120" required>
                            </div>
                            <div class="form-group">
                                <label>‡πÄ‡∏û‡∏®</label>
                                <div class="radio-group">
                                    <div class="radio-item"><input type="radio" name="gender" value="‡∏ä‡∏≤‡∏¢" id="male"><label for="male">‡∏ä‡∏≤‡∏¢</label></div>
                                    <div class="radio-item"><input type="radio" name="gender" value="‡∏´‡∏ç‡∏¥‡∏á" id="female"><label for="female">‡∏´‡∏ç‡∏¥‡∏á</label></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
                                <input type="number" id="weight" placeholder="70" min="20" max="200" step="0.1" required onchange="updateRTPAWeight()">
                            </div>
                        </div>

                        <input type="hidden" id="currentDate">
                        <input type="hidden" id="currentTime">

                        <div class="form-group" style="margin-top: 10px;">
                            <label>‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item"><input type="checkbox" id="diabetes" value="‡πÇ‡∏£‡∏Ñ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô"><label for="diabetes">‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="hypertension" value="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á"><label for="hypertension">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="heartdisease" value="‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à"><label for="heartdisease">‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="afib" value="Afib/Arrhythmia"><label for="afib">Afib/Arrhythmia</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="thromboembol" value="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î"><label for="thromboembol">‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏°‡∏≠‡∏á</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="smoking" value="‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà"><label for="smoking">‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</label></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà</label>
                            <textarea id="medications" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πá‡∏á‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à" style="min-height: 50px;"></textarea>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span>üìÖ Section 2: ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</span>
                        <span class="toggle">‚ñº</span>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="form-group">
                                <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (Last Known Well)</label>
                                <input type="time" id="symptomTime" required>
                            </div>
                            <div class="form-group">
                                <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö</label>
                                <select id="location" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                                    <option>‡∏ö‡πâ‡∏≤‡∏ô</option><option>‡∏ö‡∏ô‡∏ñ‡∏ô‡∏ô</option>
                                    <option>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</option><option>‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏∑‡πà‡∏ô</option>
                                    <option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                            </div>
                        </div>

                        <div style="background: #fffbea; padding: 10px; border-radius: 4px; margin-bottom: 15px; border: 1px solid #faebcc;">
                            <label style="margin-bottom: 8px; color: #8a6d3b;">Neurological Status</label>
                            <div class="row four" style="margin-bottom: 10px;">
                                <div class="form-group" style="margin-bottom:0;">
                                    <label style="font-size: 11px;">E (Eye)</label>
                                    <input type="number" id="gcsE" placeholder="1-4" min="1" max="4" onchange="calcGCS()">
                                </div>
                                <div class="form-group" style="margin-bottom:0;">
                                    <label style="font-size: 11px;">V (Verbal)</label>
                                    <input type="number" id="gcsV" placeholder="1-5" min="1" max="5" onchange="calcGCS()">
                                </div>
                                <div class="form-group" style="margin-bottom:0;">
                                    <label style="font-size: 11px;">M (Motor)</label>
                                    <input type="number" id="gcsM" placeholder="1-6" min="1" max="6" onchange="calcGCS()">
                                </div>
                                <div class="form-group" style="margin-bottom:0;">
                                    <label style="font-size: 11px;">Total GCS</label>
                                    <input type="number" id="gcsTotal" readonly style="background: #eee; font-weight:bold;">
                                </div>
                            </div>
                            <div class="row three">
                                <div class="form-group">
                                    <label style="font-size: 12px;">Pupil RT (mm)</label>
                                    <input type="number" id="pupilRT" placeholder="mm" min="1" max="10" step="0.5">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 12px;">Pupil LT (mm)</label>
                                    <input type="number" id="pupilLT" placeholder="mm" min="1" max="10" step="0.5">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 12px;">NIHSS Score (0-42)</label>
                                    <input type="number" id="nihss" placeholder="Score" min="0" max="42">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="margin-bottom: 10px;">Motor Signs</label>
                            <div class="motor-group">
                                <div class="motor-row">
                                    <div class="motor-item"><label>RT Upper</label><select id="motorRTUpper"><option value="">-- ‡πÑ‡∏°‡πà‡∏°‡∏µ --</option><option value="RT Upper Gr 0">Gr 0</option><option value="RT Upper Gr 1">Gr 1</option><option value="RT Upper Gr 2">Gr 2</option><option value="RT Upper Gr 3">Gr 3</option><option value="RT Upper Gr 4">Gr 4</option><option value="RT Upper Gr 5">Gr 5</option></select></div>
                                    <div class="motor-item"><label>LT Upper</label><select id="motorLTUpper"><option value="">-- ‡πÑ‡∏°‡πà‡∏°‡∏µ --</option><option value="LT Upper Gr 0">Gr 0</option><option value="LT Upper Gr 1">Gr 1</option><option value="LT Upper Gr 2">Gr 2</option><option value="LT Upper Gr 3">Gr 3</option><option value="LT Upper Gr 4">Gr 4</option><option value="LT Upper Gr 5">Gr 5</option></select></div>
                                </div>
                                <div class="motor-row">
                                    <div class="motor-item"><label>RT Lower</label><select id="motorRTLower"><option value="">-- ‡πÑ‡∏°‡πà‡∏°‡∏µ --</option><option value="RT Lower Gr 0">Gr 0</option><option value="RT Lower Gr 1">Gr 1</option><option value="RT Lower Gr 2">Gr 2</option><option value="RT Lower Gr 3">Gr 3</option><option value="RT Lower Gr 4">Gr 4</option><option value="RT Lower Gr 5">Gr 5</option></select></div>
                                    <div class="motor-item"><label>LT Lower</label><select id="motorLTLower"><option value="">-- ‡πÑ‡∏°‡πà‡∏°‡∏µ --</option><option value="LT Lower Gr 0">Gr 0</option><option value="LT Lower Gr 1">Gr 1</option><option value="LT Lower Gr 2">Gr 2</option><option value="LT Lower Gr 3">Gr 3</option><option value="LT Lower Gr 4">Gr 4</option><option value="LT Lower Gr 5">Gr 5</option></select></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="margin-bottom: 10px;">Sensory Signs</label>
                            <div class="sensory-group">
                                <div class="sensory-item">
                                    <label>RT</label>
                                    <select id="sensoryRT">
                                        <option value="Normal">Normal</option><option value="RT Sensory Decrease">Decrease</option><option value="RT Sensory Absent">Absent</option>
                                    </select>
                                </div>
                                <div class="sensory-item">
                                    <label>LT</label>
                                    <select id="sensoryLT">
                                        <option value="Normal">Normal</option><option value="LT Sensory Decrease">Decrease</option><option value="LT Sensory Absent">Absent</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Bulbar/Cortical/Cerebellar Signs</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item"><input type="checkbox" id="facialPalsyRT" value="Facial palsy RT"><label for="facialPalsyRT">Facial palsy RT</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="facialPalsyLT" value="Facial palsy LT"><label for="facialPalsyLT">Facial palsy LT</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="aphasia" value="Aphasia"><label for="aphasia">Aphasia</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dysarthria" value="Dysarthria"><label for="dysarthria">Dysarthria</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dysphagia" value="Dysphagia"><label for="dysphagia">Dysphagia</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="hemianopia" value="Homonymous hemianopia"><label for="hemianopia">Homonymous hemianopia</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ataxia" value="Ataxia"><label for="ataxia">Ataxia</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="nystagmus" value="Nystagmus"><label for="nystagmus">Nystagmus</label></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                            <textarea id="symptomDetails" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏£" style="min-height: 50px;"></textarea>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span>‚ù§Ô∏è Section 3: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
                        <span class="toggle">‚ñº</span>
                    </div>
                    <div class="section-body">
                        <label style="display: block; margin-bottom: 10px;">Vital Signs:</label>
                        <div class="row five">
                            <div class="form-group"><label style="font-size: 12px;">SBP</label><input type="number" id="sbp" placeholder="120" min="0" max="300"></div>
                            <div class="form-group"><label style="font-size: 12px;">DBP</label><input type="number" id="dbp" placeholder="80" min="0" max="200"></div>
                            <div class="form-group"><label style="font-size: 12px;">HR</label><input type="number" id="hr" placeholder="80" min="0" max="200"></div>
                            <div class="form-group"><label style="font-size: 12px;">RR</label><input type="number" id="rr" placeholder="20" min="0" max="60"></div>
                            <div class="form-group"><label style="font-size: 12px;">BT</label><input type="number" id="temp" placeholder="36.5" min="30" max="42" step="0.1"></div>
                        </div>
                        <div class="row">
                            <div class="form-group"><label style="font-size: 12px;">O2 Sat (%)</label><input type="number" id="o2sat" placeholder="98" min="0" max="100"></div>
                            <div class="form-group">
                                <label style="font-size: 12px;">‡∏ó‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤‡∏¢‡πÉ‡∏à</label>
                                <div class="radio-group" style="margin-top:0;">
                                    <div class="radio-item"><input type="radio" name="intubation" value="No" id="intubNo" checked><label for="intubNo">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</label></div>
                                    <div class="radio-item"><input type="radio" name="intubation" value="Yes" id="intubYes"><label for="intubYes">‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß</label></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="display: none;" id="intubationDetails">
                            <input type="text" id="intubationNote" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤‡∏¢‡πÉ‡∏à (‡πÄ‡∏ö‡∏≠‡∏£‡πå/‡∏•‡∏∂‡∏Å/FiO2)">
                        </div>

                        <script>
                            document.getElementById('intubYes').addEventListener('change', function() { document.getElementById('intubationDetails').style.display = 'block'; });
                            document.getElementById('intubNo').addEventListener('change', function() { document.getElementById('intubationDetails').style.display = 'none'; });
                        </script>

                        <div class="form-group" style="margin-top: 15px; padding: 10px; background: #f0f8ff; border-radius: 4px;">
                            <label>‡πÑ‡∏î‡πâ‡∏¢‡∏≤ rtPA (Thrombolytic)</label>
                            <div class="radio-group">
                                <div class="radio-item"><input type="radio" name="rtpa" value="No" id="rtpaNo" checked onchange="toggleRTPAInput()"><label for="rtpaNo">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</label></div>
                                <div class="radio-item"><input type="radio" name="rtpa" value="Yes" id="rtpaYes" onchange="toggleRTPAInput()"><label for="rtpaYes">‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß</label></div>
                            </div>
                            <div id="rtpaInputGroup" style="display: none; margin-top: 10px;">
                                <div class="form-group"><label>‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ rtPA</label><input type="time" id="rtpaTime"></div>
                                <div class="form-group"><label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label><input type="number" id="rtpaWeight" placeholder="70" min="20" max="200" step="0.1" onchange="calculateRTPAdoses()"></div>
                                <div class="form-group">
                                    <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≤</label>
                                    <div class="radio-group">
                                        <div class="radio-item"><input type="radio" name="rtpaDose" value="standard" id="doseStandard" checked onchange="calculateRTPAdoses()"><label for="doseStandard">Standard: 0.9 mg/kg</label></div>
                                        <div class="radio-item"><input type="radio" name="rtpaDose" value="alternative" id="doseAlternative" onchange="calculateRTPAdoses()"><label for="doseAlternative">Alternative: 0.6 mg/kg</label></div>
                                    </div>
                                </div>
                                <div class="calculate-box">
                                    <div style="font-weight: bold; margin-bottom: 5px; color: var(--primary);">üìä ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≤ rtPA:</div>
                                    <div class="calculate-item"><span>Total Dose:</span><strong id="calcTotal">0</strong> mg</div>
                                    <div class="calculate-item"><span id="pushLabel">Bolus:</span><strong id="calcBolus">0</strong> mg</div>
                                    <div class="calculate-item"><span>Drip:</span><strong id="calcInfusion">0</strong> mg</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span>üñºÔ∏è Section 4: ‡∏ú‡∏• Imaging</span>
                        <span class="toggle">‚ñº</span>
                    </div>
                    <div class="section-body">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">CT Brain Occlusion (Large Vessel)</label>

                        <div style="background: #f9f9f9; padding: 10px; border-radius: 4px; border: 1px solid #eee;">
                            <div class="form-group">
                                <label style="font-size: 13px;">1. ‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≤‡∏á (Side)</label>
                                <div class="radio-group">
                                    <div class="radio-item"><input type="radio" name="ct_side" value="Right" id="side_rt"><label for="side_rt">Right (‡∏Ç‡∏ß‡∏≤)</label></div>
                                    <div class="radio-item"><input type="radio" name="ct_side" value="Left" id="side_lt"><label for="side_lt">Left (‡∏ã‡πâ‡∏≤‡∏¢)</label></div>
                                    <div class="radio-item"><input type="radio" name="ct_side" value="Bilateral" id="side_bi"><label for="side_bi">Bilateral (‡∏™‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏á)</label></div>
                                    <div class="radio-item"><input type="radio" name="ct_side" value="None" id="side_none"><label for="side_none">None (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏/‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥)</label></div>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 10px;">
                                <label style="font-size: 13px;">2. ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î (Vessel)</label>
                                <div class="checkbox-group"> 
                                    <div class="checkbox-item"><input type="checkbox" id="vessel_ica" value="ICA"><label for="vessel_ica">ICA</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="vessel_m1" value="MCA M1"><label for="vessel_m1">MCA M1</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="vessel_m2" value="MCA M2"><label for="vessel_m2">MCA M2</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="vessel_aca" value="ACA"><label for="vessel_aca">ACA (A1/A2)</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="vessel_pca" value="PCA"><label for="vessel_pca">PCA (P1)</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="vessel_basilar" value="Basilar Artery"><label for="vessel_basilar">Basilar</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="vessel_vert" value="Vertebral Artery"><label for="vessel_vert">Vertebral</label></div>
                                    <div class="checkbox-item" style="display: flex; align-items: center;">
                                        <input type="checkbox" id="vessel_other" value="Other">
                                        <label for="vessel_other" style="margin-right: 5px;">Other</label>
                                        <input type="text" id="vessel_other_text" placeholder="‡∏£‡∏∞‡∏ö‡∏∏..." style="width: 150px; padding: 2px 5px; height: 25px;" onclick="document.getElementById('vessel_other').checked = true">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 15px;">
                            <label>ASPECTS Score</label>
                            <input type="number" id="aspects" placeholder="0-10 (‡∏™‡∏π‡∏á = ‡∏î‡∏µ)" min="0" max="10">
                        </div>

                        <div class="form-group">
                            <label style="font-size: 12px;">‡∏ú‡∏• CT Brain ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item"><input type="checkbox" id="ct_acute_infarct" value="Acute infarct"><label for="ct_acute_infarct">Acute infarct</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ct_hypodensity" value="Hypodensity"><label for="ct_hypodensity">Hypodensity</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ct_no_hemorrhage" value="No hemorrhage"><label for="ct_no_hemorrhage">No hemorrhage</label></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î CT Brain</label>
                            <textarea id="ctFindings" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°" style="min-height: 50px;"></textarea>
                        </div>

                        <label style="display: block; margin-top: 15px; margin-bottom: 8px; font-weight: bold;">Additional Imaging</label>
                        <div class="form-group">
                            <div class="radio-group">
                                <div class="radio-item"><input type="radio" name="additionalImaging" value="None" id="addImaging_none" checked onchange="toggleAdditionalImaging()"><label for="addImaging_none">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥</label></div>
                                <div class="radio-item"><input type="radio" name="additionalImaging" value="CTA Brain & Neck" id="addImaging_cta" onchange="toggleAdditionalImaging()"><label for="addImaging_cta">CTA Brain & Neck</label></div>
                                <div class="radio-item"><input type="radio" name="additionalImaging" value="MRI Brain" id="addImaging_mri" onchange="toggleAdditionalImaging()"><label for="addImaging_mri">MRI Brain</label></div>
                            </div>
                        </div>
                        <div id="additionalImagingGroup" style="display: none;">
                            <textarea id="additionalImagingFindings" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏• Additional Imaging" style="min-height: 50px;"></textarea>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span>üéØ Section 5: ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á (Thrombectomy Indication)</span>
                        <span class="toggle">‚ñº</span>
                    </div>
                    <div class="section-body">
                        <label>Indication MT (Checklist)</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item"><input type="checkbox" id="criterion1" value="Large vessel occlusion confirmed"><label for="criterion1">LVO Confirmed</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="criterion2" value="Within intervention window"><label for="criterion2">In Time Window</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="criterion3" value="NIHSS >= 6"><label for="criterion3">NIHSS ‚â• 6</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="criterion5" value="ASPECTS score >= 6"><label for="criterion5">ASPECTS Score ‚â• 6</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="criterion6" value="Pre-stroke mRS 0-1"><label for="criterion6">Pre-stroke mRS 0-1</label></div>
                        </div>

                        <div class="form-group" style="margin-top: 15px;">
                            <label>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°/Consideration</label>
                            <textarea id="contraindications" placeholder="‡∏£‡∏∞‡∏ö‡∏∏ Contraindications ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ"></textarea>
                        </div>
                    </div>
                </div>
            
                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span>üìû Section 6: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</span>
                        <span class="toggle">‚ñº</span>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="form-group">
                                <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ç‡∏≤‡∏ï‡∏¥</label>
                                <select id="familyRelation">
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                                    <option>‡∏•‡∏π‡∏Å</option><option>‡∏•‡∏π‡∏Å‡∏™‡∏∞‡πÉ‡∏†‡πâ</option><option>‡∏´‡∏•‡∏≤‡∏ô</option>
                                    <option>‡∏û‡∏µ‡πà</option><option>‡∏ô‡πâ‡∏≠‡∏á</option><option>‡πÅ‡∏°‡πà</option>
                                    <option>‡∏û‡πà‡∏≠</option><option>‡∏™‡∏≤‡∏°‡∏µ</option><option>‡∏†‡∏£‡∏£‡∏¢‡∏≤</option><option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                <input type="tel" id="familyPhone" placeholder="089-1234567">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-primary" onclick="generatePreview(false)">üìÑ Generate & Print Preview</button>
                    <button type="button" class="btn-info" onclick="generatePreview(true)">üñ®Ô∏è Print Blank Form (‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏õ‡∏•‡πà‡∏≤)</button>
                    <button type="button" class="btn-danger" onclick="clearForm()">üóëÔ∏è Clear All</button>
                </div>
            </form>
        </div>
        
        <div style="text-align: center; padding: 20px; margin-top: 20px; border-top: 1px solid #eee; font-size: 13px; color: #666;">
            &copy; 2025 <a href="https://github.com/NTWKKM/" target="_blank" style="text-decoration: none; color: var(--primary); font-weight: bold;">NTWKKM & Donate</a>
        </div>
    </div>

    <div class="print-preview" id="printPreview">
        <div class="print-document" id="printDocument">
            <div class="print-header">
                <h1>üè• STROKE FAST TRACK - MECHANICAL THROMBECTOMY REFERRAL</h1>
                <p>‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤</p>
            </div>

            <div class="print-section">
                <div class="print-section-title">
                    <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (Patient Information)</span>
                    <span style="font-weight: normal; font-size: 11px;" id="p_headerDate"></span>
                </div>
                <div class="print-row">
                    <div class="print-field print-col-33" id="pf_hn"><span class="print-field-label">HN</span><span class="print-field-value" id="p_hn"></span></div>
                    <div class="print-field print-col-33" id="pf_name"><span class="print-field-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</span><span class="print-field-value" id="p_name"></span></div>
                    <div class="print-field print-col-33" id="pf_age"><span class="print-field-label">‡∏≠‡∏≤‡∏¢‡∏∏</span><span class="print-field-value" id="p_age"></span></div>
                    <div class="print-field print-col-33" id="pf_gender"><span class="print-field-label">‡πÄ‡∏û‡∏®</span><span class="print-field-value" id="p_gender"></span></div>
                    <div class="print-field print-col-33" id="pf_weight"><span class="print-field-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</span><span class="print-field-value" id="p_weight"></span></div>
                </div>
                <div class="print-row">
                    <div class="print-field print-col-100" id="pf_comorbidities"><span class="print-field-label">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</span><span class="print-field-value" id="p_comorbidities"></span></div>
                </div>
                <div class="print-row">
                    <div class="print-field print-col-100" id="pf_medications"><span class="print-field-label">‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</span><span class="print-field-value" id="p_medications"></span></div>
                </div>
            </div>

            <div class="print-section">
                <div class="print-section-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (History & Symptoms)</div>
                <div class="print-row">
                    <div class="print-field" style="width: 25%;" id="pf_symptomTime">
                        <span class="print-field-label">LKW</span><span class="print-field-value" id="p_symptomTime"></span>
                    </div>
                    <div class="print-layout-loc" style="width: 73%;">
                        <div class="print-field" id="pf_location">
                            <span class="print-field-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</span><span class="print-field-value" id="p_location"></span>
                        </div>
                        <div class="print-field" id="pf_gcs">
                            <span class="print-field-label">GCS</span><span class="print-field-value" id="p_gcs"></span>
                        </div>
                        <div class="print-field" id="pf_pupils">
                            <span class="print-field-label">Pupils</span><span class="print-field-value" id="p_pupils"></span>
                        </div>
                        <div class="print-field" id="pf_nihss">
                            <span class="print-field-label">NIHSS</span><span class="print-field-value" id="p_nihss"></span>
                        </div>
                    </div>
                </div>

                <div class="print-row">
                    <div class="print-field print-col-100" id="pf_motorSigns"><span class="print-field-label">Motor Signs</span><span class="print-field-value" id="p_motorSigns"></span></div>
                </div>

                <div class="print-row">
                    <div class="print-field print-col-100" id="pf_sensoryBulbar">
                        <span class="print-field-label">Sensory/Bulbar</span>
                        <span class="print-field-value">
                            <span id="p_sensorySigns"></span> <span id="p_bulbarSigns" style="margin-left: 10px; color: #555;"></span>
                        </span>
                    </div>
                </div>
            </div>

            <div class="print-section">
                <div style="margin-bottom: 3px; font-weight: bold; font-size: 11px;">Vital Signs:</div>
                <div class="print-row">
                    <div class="print-field print-col-25" id="pf_bp"><span class="print-field-label">BP</span><span class="print-field-value" id="p_bp"></span></div>
                    <div class="print-field print-col-25" id="pf_hr"><span class="print-field-label">HR</span><span class="print-field-value" id="p_hr"></span></div>
                    <div class="print-field print-col-25" id="pf_rr"><span class="print-field-label">RR</span><span class="print-field-value" id="p_rr"></span></div>
                    <div class="print-field print-col-25" id="pf_o2sat"><span class="print-field-label">O2 Sat</span><span class="print-field-value" id="p_o2sat"></span></div>
                </div>
                <div class="print-row">
                    <div class="print-field print-col-50" id="pf_intubation"><span class="print-field-label">Intubation</span><span class="print-field-value" id="p_intubation"></span></div>
                </div>
            </div>

            <div class="print-section" id="rtpaSection" style="display: none;">
                <div class="print-section-title">‡∏¢‡∏≤ rtPA (Thrombolytic Therapy)</div>
                <div class="print-row" id="rtpaRowGiven">
                    <div class="print-field print-col-50"><span class="print-field-label">Given</span><span class="print-field-value">Yes</span></div>
                    <div class="print-field print-col-50"><span class="print-field-label">Time</span><span class="print-field-value" id="p_rtpaTime"></span></div>
                </div>
                <div class="print-box" id="rtpaDosesBox" style="font-size: 11px;"></div>
            </div>

            <div class="print-section">
                <div class="print-section-title">‡∏ú‡∏• Imaging</div>
                <div class="print-row">
                    <div class="print-field print-col-100" id="pf_territory"><span class="print-field-label">Target Vessel</span><span class="print-field-value" id="p_territory"></span></div>
                </div>
                <div class="print-row">
                    <div class="print-field print-col-50" id="pf_aspects"><span class="print-field-label">ASPECTS</span><span class="print-field-value" id="p_aspects"></span></div>
                    <div class="print-field print-col-50" id="pf_ctFindings"><span class="print-field-label">Findings</span><span class="print-field-value" id="p_ctFindings"></span></div>
                </div>
                <div class="print-row">
                    <div class="print-field print-col-100" id="pf_ctDetails"><span class="print-field-label">Detail</span><span class="print-field-value" id="p_ctDetails"></span></div>
                </div>
                <div class="print-row">
                    <div class="print-field print-col-100" id="pf_additionalImaging"><span class="print-field-label">Add. Imaging</span><span class="print-field-value" id="p_additionalImaging"></span></div>
                </div>
            </div>

            <div class="print-section">
                <div class="print-section-title">Indication MT</div>
                <div class="print-row">
                    <div class="print-field print-col-100" id="pf_criteria"><span class="print-field-label">Criteria</span><span class="print-field-value" id="p_criteria"></span></div>
                </div>
                <div class="print-row">
                    <div class="print-field print-col-100" id="pf_contraindications"><span class="print-field-label">Consideration</span><span class="print-field-value" id="p_contraindications"></span></div>
                </div>
            </div>

            <div class="print-section" id="section_contact">
                <div class="print-section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</div>
                <div class="print-row">
                    <div class="print-field print-col-50" id="pf_familyRelation"><span class="print-field-label">‡∏ç‡∏≤‡∏ï‡∏¥</span><span class="print-field-value" id="p_familyRelation"></span></div>
                    <div class="print-field print-col-50" id="pf_familyPhone"><span class="print-field-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</span><span class="print-field-value" id="p_familyPhone"></span></div>
                </div>
            </div>

            <div class="print-signature">
                <div style="font-size: 11px; margin-bottom: 5px;" id="p_signDate"></div>
                <div style="font-size: 12px; font-weight: bold; margin-bottom: 40px;">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á</div>
                <div class="signature-line">
                    ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•: ___________________________________
                </div>
            </div>

            <div style="margin-top: 15px; text-align: center; font-size: 10px; color: #999; border-top: 1px solid #ccc; padding-top: 5px;">
                Stroke FAST TRACK - Mechanical Thrombectomy Referral | ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤
            </div>
        </div>

        <div style="margin-top: 20px; text-align: center; padding-bottom: 40px;">
            <button type="button" class="btn-secondary" onclick="printDocument()" style="margin-right: 10px;">üñ®Ô∏è Print This Document</button>
            <button type="button" class="btn-danger" onclick="closePreview()">‚Üê Back to Edit</button>
        </div>
    </div>

    <script>
        function initializeDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('th-TH');
            const timeStr = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('currentDate').value = dateStr;
            document.getElementById('currentTime').value = timeStr;
        }

        function toggleSection(header) {
            const body = header.nextElementSibling;
            body.classList.toggle('active');
            const toggle = header.querySelector('.toggle');
            toggle.style.transform = body.classList.contains('active') ? 'rotate(0deg)' : 'rotate(-90deg)';
        }

        function calcGCS() {
            const e = parseInt(document.getElementById('gcsE').value) || 0;
            const v = parseInt(document.getElementById('gcsV').value) || 0;
            const m = parseInt(document.getElementById('gcsM').value) || 0;
            document.getElementById('gcsTotal').value = (e+v+m) || '';
        }

        function toggleAdditionalImaging() {
            const hasAdditional = document.querySelector('input[name="additionalImaging"]:checked').value !== 'None';
            document.getElementById('additionalImagingGroup').style.display = hasAdditional ? 'block' : 'none';
        }

        function toggleRTPAInput() {
            const rtpaYes = document.getElementById('rtpaYes').checked;
            document.getElementById('rtpaInputGroup').style.display = rtpaYes ? 'block' : 'none';
            if (rtpaYes) calculateRTPAdoses();
        }

        function updateRTPAWeight() {
            document.getElementById('rtpaWeight').value = document.getElementById('weight').value;
            calculateRTPAdoses();
        }

        function calculateRTPAdoses() {
            const weight = parseFloat(document.getElementById('rtpaWeight').value) || 0;
            const isStandard = document.getElementById('doseStandard').checked;
            const dosage = isStandard ? 0.9 : 0.6;
            const maxDose = 90;
            let totalDose = Math.min(weight * dosage, maxDose);
            let bolus = totalDose * (isStandard ? 0.1 : 0.15);
            let infusion = totalDose - bolus;

            document.getElementById('calcTotal').textContent = totalDose.toFixed(1);
            document.getElementById('calcBolus').textContent = bolus.toFixed(1);
            document.getElementById('calcInfusion').textContent = infusion.toFixed(1);
            document.getElementById('pushLabel').textContent = isStandard ? '10% Push:' : '15% Push:';
        }

        function getCheckedValues(ids) {
            return ids.filter(id => document.getElementById(id).checked).map(id => document.getElementById(id).value).join(', ');
        }
        
        function setPrint(elementId, containerId, value, suffix = '', isBlank = false) {
            const container = document.getElementById(containerId);
            const element = document.getElementById(elementId);
            
            if (isBlank) {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î Blank ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ‡πÅ‡∏•‡∏∞‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞
                container.style.display = 'flex';
                if (!value || value.includes('checkbox-square')) {
                    // ‡∏ñ‡πâ‡∏≤ value ‡∏°‡∏µ html checkbox ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ value ‡πÄ‡∏•‡∏¢
                    if(value && value.includes('checkbox-square')) {
                         element.innerHTML = value;
                    } else {
                         element.innerHTML = '<span style="border-bottom: 1px dotted #999; display: inline-block; width: 100%; min-width: 50px;">&nbsp;</span>';
                    }
                } else {
                    element.innerHTML = value + suffix;
                }
                return;
            }

            if (!value || value === '' || value === '-' || value === 'Normal') {
                if (value === 'Normal') {
                     element.textContent = value;
                     container.style.display = 'flex';
                     return;
                }
                container.style.display = 'none';
                element.textContent = '';
            } else {
                container.style.display = 'flex';
                element.textContent = value + suffix;
            }
        }
        
        // Helper ‡∏™‡∏£‡πâ‡∏≤‡∏á Checkbox ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î Blank
        function getBlankCheckboxes(labels) {
            return labels.map(label => `<span class="checkbox-square"></span><span class="checkbox-label">${label}</span>`).join(' ');
        }

        function generatePreview(isBlank) {
            // Data Object
            let data = {};
            
            if (isBlank) {
                // ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏õ‡∏•‡πà‡∏≤: ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML Checkbox ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏
                data = {
                    date: "..........................", time: "..........................",
                    comorbidities: getBlankCheckboxes(['‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô', '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô', '‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à', 'Afib', 'Old CVA', '‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà']),
                    
                    targetVessel: getBlankCheckboxes(['Right', 'Left', 'ICA', 'M1', 'M2', 'ACA', 'PCA', 'Basilar', 'Vert']),
                    sensory: getBlankCheckboxes(['Normal', 'Decrease', 'Absent']),
                    bulbar: getBlankCheckboxes(['Facial Palsy', 'Aphasia', 'Dysarthria', 'Neglect']),
                    
                    addImg: getBlankCheckboxes(['CTA Brain/Neck', 'MRI Brain', 'Other: _________']),
                    criteria: getBlankCheckboxes(['LVO Confirmed', 'In Window', 'NIHSS>=6', 'ASPECTS>=6', 'Pre-mRS 0-1']) + '<br><span class="checkbox-square"></span> Contraindication: ________________',
                    
                    rtpa: 'BLANK_MODE' // Flag ‡∏û‡∏¥‡πÄ‡∏®‡∏©
                };
            } else {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
                data = {
                    hn: document.getElementById('hn').value,
                    name: document.getElementById('name').value,
                    age: document.getElementById('age').value,
                    gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                    weight: document.getElementById('weight').value,
                    medications: document.getElementById('medications').value,
                    
                    symptomTime: document.getElementById('symptomTime').value,
                    location: document.getElementById('location').value,
                    
                    gcsE: document.getElementById('gcsE').value,
                    gcsV: document.getElementById('gcsV').value,
                    gcsM: document.getElementById('gcsM').value,
                    gcsTotal: document.getElementById('gcsTotal').value,
                    pupilRT: document.getElementById('pupilRT').value,
                    pupilLT: document.getElementById('pupilLT').value,
                    nihss: document.getElementById('nihss').value,

                    motorRT_Upper: document.getElementById('motorRTUpper').value,
                    motorLT_Upper: document.getElementById('motorLTUpper').value,
                    motorRT_Lower: document.getElementById('motorRTLower').value,
                    motorLT_Lower: document.getElementById('motorLTLower').value,
                    
                    sensoryRT: document.getElementById('sensoryRT').value,
                    sensoryLT: document.getElementById('sensoryLT').value,
                    bulbar: getCheckedValues(['facialPalsyRT', 'facialPalsyLT', 'aphasia', 'dysarthria', 'dysphagia', 'hemianopia', 'ataxia', 'nystagmus']),
                    
                    sbp: document.getElementById('sbp').value,
                    dbp: document.getElementById('dbp').value,
                    hr: document.getElementById('hr').value,
                    rr: document.getElementById('rr').value,
                    o2sat: document.getElementById('o2sat').value,
                    intubation: document.querySelector('input[name="intubation"]:checked')?.value,
                    intubNote: document.getElementById('intubationNote').value,

                    rtpa: document.querySelector('input[name="rtpa"]:checked')?.value,
                    
                    ctSide: document.querySelector('input[name="ct_side"]:checked')?.value || '',
                    ctVessels: getCheckedValues(['vessel_ica', 'vessel_m1', 'vessel_m2', 'vessel_aca', 'vessel_pca', 'vessel_basilar', 'vessel_vert']),
                    aspects: document.getElementById('aspects').value,
                    ctFindings: getCheckedValues(['ct_acute_infarct', 'ct_hypodensity', 'ct_no_hemorrhage']),
                    ctDetails: document.getElementById('ctFindings').value,
                    
                    addImgType: document.querySelector('input[name="additionalImaging"]:checked')?.value,
                    addImgNote: document.getElementById('additionalImagingFindings').value,
                    
                    criteria: getCheckedValues(['criterion1', 'criterion2', 'criterion3', 'criterion5', 'criterion6']),
                    contraindications: document.getElementById('contraindications').value,
                    
                    famRel: document.getElementById('familyRelation').value,
                    famPhone: document.getElementById('familyPhone').value,
                    
                    date: document.getElementById('currentDate').value,
                    time: document.getElementById('currentTime').value
                };

                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Other Vessel
                if(document.getElementById('vessel_other').checked) {
                    const otherText = document.getElementById('vessel_other_text').value;
                    if(otherText) {
                        data.ctVessels += (data.ctVessels ? ', ' : '') + 'Other: ' + otherText;
                    }
                }
            }

            // Set Header & Date
            if(isBlank) {
                document.getElementById('p_headerDate').innerHTML = "Date: ....................... Time: .......................";
                document.getElementById('p_signDate').innerHTML = "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ....................... ‡πÄ‡∏ß‡∏•‡∏≤ .......................";
            } else {
                document.getElementById('p_headerDate').textContent = `Date: ${data.date} Time: ${data.time}`;
                document.getElementById('p_signDate').textContent = `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${data.date} ‡πÄ‡∏ß‡∏•‡∏≤ ${data.time}`;
            }

            // Patient Info
            setPrint('p_hn', 'pf_hn', data.hn, '', isBlank);
            setPrint('p_name', 'pf_name', data.name, '', isBlank);
            setPrint('p_age', 'pf_age', data.age, ' ‡∏õ‡∏µ', isBlank);
            setPrint('p_gender', 'pf_gender', data.gender, '', isBlank);
            setPrint('p_weight', 'pf_weight', data.weight, ' kg', isBlank);
            
            // Comorbidities (‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡∏ñ‡πâ‡∏≤ Blank)
            if (isBlank) {
                setPrint('p_comorbidities', 'pf_comorbidities', data.comorbidities, '', isBlank);
            } else {
                setPrint('p_comorbidities', 'pf_comorbidities', getCheckedValues(['diabetes', 'hypertension', 'heartdisease', 'afib', 'thromboembol', 'smoking']), '', isBlank);
            }
            
            setPrint('p_medications', 'pf_medications', data.medications, '', isBlank);

            // History
            setPrint('p_symptomTime', 'pf_symptomTime', data.symptomTime, '', isBlank);
            setPrint('p_location', 'pf_location', data.location, '', isBlank);
            
            // GCS
            let gcsTxt = '';
            if(!isBlank && data.gcsTotal) gcsTxt = `E${data.gcsE}V${data.gcsV}M${data.gcsM} (${data.gcsTotal})`;
            setPrint('p_gcs', 'pf_gcs', gcsTxt, '', isBlank);
            
            // Pupil
            let pupilTxt = '';
            if(!isBlank && (data.pupilRT || data.pupilLT)) pupilTxt = `Rt ${data.pupilRT||'-'} / Lt ${data.pupilLT||'-'} mm`;
            setPrint('p_pupils', 'pf_pupils', pupilTxt, '', isBlank);
            
            setPrint('p_nihss', 'pf_nihss', data.nihss, '', isBlank);

            // Motor
            let motorArr = [];
            if(!isBlank) motorArr = [data.motorRT_Upper, data.motorLT_Upper, data.motorRT_Lower, data.motorLT_Lower].filter(x => x);
            setPrint('p_motorSigns', 'pf_motorSigns', motorArr.join(', '), '', isBlank);

            // Sensory + Bulbar
            if(isBlank) {
                 setPrint('p_sensorySigns', 'pf_sensoryBulbar', `Sensory: ${data.sensory} <br> Bulbar: ${data.bulbar}`, '', isBlank);
            } else {
                let sensBulbTxt = '';
                const sensoryArr = [data.sensoryRT, data.sensoryLT].filter(x => x && x!=='Normal');
                sensBulbTxt = sensoryArr.join(', ');
                if(data.bulbar) sensBulbTxt += (sensBulbTxt ? ', ' : '') + data.bulbar;
                if(!sensBulbTxt) sensBulbTxt = 'Normal/None';
                setPrint('p_sensorySigns', 'pf_sensoryBulbar', sensBulbTxt, '', isBlank); 
            }

            // Vital Signs
            let bpTxt = (data.sbp && data.dbp) ? `${data.sbp}/${data.dbp}` : '';
            setPrint('p_bp', 'pf_bp', bpTxt, '', isBlank);
            setPrint('p_hr', 'pf_hr', data.hr, '', isBlank);
            setPrint('p_rr', 'pf_rr', data.rr, '', isBlank);
            setPrint('p_o2sat', 'pf_o2sat', data.o2sat, '%', isBlank);
            
            let intubTxt = '';
            if(!isBlank) {
                intubTxt = data.intubation === 'Yes' ? 'Yes' : 'No';
                if(data.intubNote) intubTxt += ` (${data.intubNote})`;
            }
            setPrint('p_intubation', 'pf_intubation', intubTxt, '', isBlank);

            // rtPA Logic Updated
            const rtpaSection = document.getElementById('rtpaSection');
            const rtpaRowGiven = document.getElementById('rtpaRowGiven');
            const rtpaDosesBox = document.getElementById('rtpaDosesBox');
            
            if (isBlank) {
                rtpaSection.style.display = 'block';
                // ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Checkbox ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î Blank
                rtpaRowGiven.innerHTML = `
                    <div class="print-field print-col-100" style="border:none;">
                        <span class="checkbox-square"></span> ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö rtPA ‡πÄ‡∏ß‡∏•‡∏≤: <span style="border-bottom: 1px dotted #999; display:inline-block; width: 60px;">&nbsp;</span> ‡∏ô.
                        &nbsp;&nbsp;‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: <span style="border-bottom: 1px dotted #999; display:inline-block; width: 40px;">&nbsp;</span> kg
                    </div>
                `;
                rtpaDosesBox.innerHTML = `
                   <div style="display:flex; gap:10px; margin-top:5px;">
                      <span>Total dose: <span style="border-bottom: 1px dotted #999; display:inline-block; width: 40px;">&nbsp;</span> mg</span>
                      <span>Bolus: <span style="border-bottom: 1px dotted #999; display:inline-block; width: 40px;">&nbsp;</span> mg</span>
                      <span>Drip: <span style="border-bottom: 1px dotted #999; display:inline-block; width: 40px;">&nbsp;</span> mg</span>
                   </div>
                `;
            } else if(data.rtpa === 'Yes') {
                rtpaSection.style.display = 'block';
                // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
                rtpaRowGiven.innerHTML = `
                    <div class="print-field print-col-50"><span class="print-field-label">Given</span><span class="print-field-value">Yes</span></div>
                    <div class="print-field print-col-50"><span class="print-field-label">Time</span><span class="print-field-value" id="p_rtpaTime">${document.getElementById('rtpaTime').value}</span></div>
                `;
                rtpaDosesBox.innerHTML = document.getElementById('calculate-box')?.innerHTML || `Total: ${document.getElementById('calcTotal').textContent} mg`;
            } else {
                rtpaSection.style.display = 'none';
            }

            // Imaging
            if(isBlank) {
                setPrint('p_territory', 'pf_territory', data.targetVessel, '', isBlank);
                setPrint('p_additionalImaging', 'pf_additionalImaging', data.addImg, '', isBlank);
            } else {
                let territory = '';
                if(data.ctSide) territory += data.ctSide + ' ';
                if(data.ctVessels) territory += data.ctVessels;
                setPrint('p_territory', 'pf_territory', territory, '', isBlank);
                
                let addImgTxt = data.addImgType === 'None' ? '' : data.addImgType;
                if(data.addImgNote) addImgTxt += ` (${data.addImgNote})`;
                setPrint('p_additionalImaging', 'pf_additionalImaging', addImgTxt, '', isBlank);
            }
            
            setPrint('p_aspects', 'pf_aspects', data.aspects, '', isBlank);
            setPrint('p_ctFindings', 'pf_ctFindings', data.ctFindings, '', isBlank);
            setPrint('p_ctDetails', 'pf_ctDetails', data.ctDetails, '', isBlank);

            // Indication & Contact
            if(isBlank) {
                setPrint('p_criteria', 'pf_criteria', data.criteria, '', isBlank);
                document.getElementById('pf_contraindications').style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏ß‡∏°‡πÉ‡∏ô criteria ‡πÅ‡∏•‡πâ‡∏ß
            } else {
                setPrint('p_criteria', 'pf_criteria', data.criteria, '', isBlank);
                setPrint('p_contraindications', 'pf_contraindications', data.contraindications, '', isBlank);
            }

            setPrint('p_familyRelation', 'pf_familyRelation', data.famRel, '', isBlank);
            setPrint('p_familyPhone', 'pf_familyPhone', data.famPhone, '', isBlank);
            
            // Always show contact section in blank mode
            document.getElementById('section_contact').style.display = (isBlank || data.famRel || data.famPhone) ? 'block' : 'none';

            document.getElementById('printPreview').classList.add('show');
            document.querySelector('.container').style.display = 'none';
            window.scrollTo(0,0);
        }

        function printDocument() { window.print(); }
        function closePreview() {
            document.getElementById('printPreview').classList.remove('show');
            document.querySelector('.container').style.display = 'block';
        }
        function clearForm() {
            if(confirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) {
                document.getElementById('referralForm').reset();
                initializeDateTime();
            }
        }

        window.onload = initializeDateTime;
    </script>
</body>
</html>
